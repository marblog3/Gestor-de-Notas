<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de Administración</title>
  <link rel="website icon" type="png" href="..\img\logo.png">
  <link rel="stylesheet" href="../css/base.css">
  <link rel="stylesheet" href="../css/admin.css">
  <link rel="stylesheet" href="../css/responsive.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
  <header class="main-header">
    <div class="header-left">
      <img src="../img/logo.png" alt="Logo" class="header-logo">
      <h1 class="header-title">E.E.S.T.N°5</h1>
    </div>
    <div class="user-popup-template">
      <div tabindex="0" class="user-popup button" style="padding: 0 0.5rem 0; border-radius: 1.2rem">
        <div class="popup-header">
          <p style="
              letter-spacing: 1px;
              font-weight: 600;
              padding: 0.625rem 0.5rem;
            " id="user-email-display">
            cargando...
          </p>
          <svg class="icon" style="width: 32px; height: 32px; fill: #FFCE8B" viewBox="0 0 20 20">
            <path d="M10 2a4 4 0 1 0 0 8 4 4 0 0 0 0-8zm0 10c-4.411 0-8 1.79-8 4v2h16v-2c0-2.21-3.589-4-8-4z"></path>
          </svg>
        </div>

        <div class="popup-main">
          <ul class="list-box">
            <li class="button item" onclick="showPersonalInfo()">
              Información Personal
            </li>
            <hr />
            <li class="button item quit" onclick="logout()">Cerrar Sesión</li>
          </ul>
        </div>
      </div>
    </div>
  </header>

  <div class="boletin-container">
    <h1>PANEL DE ADMINISTRACIÓN</h1>
    <h2 class="titulo-2">Usuarios registrados</h2>

    <div class="search-container">
      <input type="text" id="searchInput" onkeyup="searchUsers()" placeholder="Buscar por nombre, correo o DNI..."
        autocomplete="off">
    </div>

    <div style="max-height: 400px; overflow-y: auto; margin-bottom: 20px; border: 1px solid #ccc;">
      <table class="boletin" id="usersTable">
        <thead>
          <tr>
            <th>Nombre Completo</th>
            <th>DNI</th>
            <th>Correo</th>
            <th>Rol</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="contenedor-botones">
      <button onclick="openCreateModal()"><b>➕ Crear Usuario</b></button>
    </div>

    <div id="notificationPanel" class="notification-panel">
      <h3 onclick="toggleSolicitudes()" class="toggle-title">
        Solicitudes de Registro <span id="flecha">⬇</span>
      </h3>
      <div id="solicitudesContent">
        <ul id="pendingList"></ul>
      </div>
    </div>

    <div class="column-layout-container" style="max-width: 1700px; margin: 20px auto;">

      <div class="form-container">
        <h2>Asignar Alumno a Curso</h2>
        <form id="asignarAlumnoForm">
          <div class="form-group">
            <label for="alumnoSelect">Alumno:</label>
            <select id="alumnoSelect" name="alumnoSelect" required></select>
          </div>
          <div class="form-group">
            <label for="anioInput">Año:</label>
            <select id="anioInput">
              <option value="">Seleccionar año</option>
              <option value="1ro">1ro</option>
              <option value="2do">2do</option>
              <option value="3ro">3ro</option>
              <option value="4to">4to</option>
              <option value="5to">5to</option>
              <option value="6to">6to</option>
              <option value="7mo">7mo</option>
            </select>
          </div>
          <div class="form-group">
            <label for="divisionInput">División:</label>
            <select id="divisionInput">
              <option value="">Seleccionar división</option>
              <option value="1ra">1ra</option>
              <option value="2da">2da</option>
              <option value="3ra">3ra</option>
              <option value="4ta">4ta</option>
              <option value="5ta">5ta</option>
              <option value="6ta">6ta</option>
              <option value="7ma">7ma</option>
              <option value="8va">8va</option>
              <option value="9na">9na</option>
            </select>
          </div>
          <div class="form-group">
            <label for="especialidadInput">Especialidad:</label>
            <select id="especialidadInput">
              <option value="Informática">Informática</option>
              <option value="Maestro Mayor de Obra">Maestro Mayor de Obra</option>
              <option value="Electromecánica">Electromecánica</option>
              <option value="Química">Química</option>
              <option value="Ciclo Básico">Ciclo Básico</option>
            </select>
          </div>
          <div class="form-group">
            <label for="turnoInputAlumno">Turno:</label>
            <select id="turnoInputAlumno">
              <option value="">Seleccionar turno</option>
              <option value="Mañana">Mañana</option>
              <option value="Tarde">Tarde</option>
              <option value="Vespertino">Vespertino</option>
            </select>
          </div>
          <button type="submit">Asignar Alumno</button>
        </form>
      </div>

      <div class="form-container">
        <h2>Asignar Profesor a Materia</h2>
        <form id="asignarProfesorForm">
          <div class="form-group">
            <label for="profesorSelect">Profesor:</label>
            <select id="profesorSelect" name="profesorSelect" required></select>
          </div>
          <div class="form-group">
            <label for="anioSelectProfesor">Año:</label>
            <select id="anioSelectProfesor">
              <option value="">Seleccionar año</option>
              <option value="1ro">1ro</option>
              <option value="2do">2do</option>
              <option value="3ro">3ro</option>
              <option value="4to">4to</option>
              <option value="5to">5to</option>
              <option value="6to">6to</option>
              <option value="7mo">7mo</option>
            </select>
          </div>
          <div class="form-group">
            <label for="divisionSelectProfesor">División:</label>
            <select id="divisionSelectProfesor">
              <option value="">Seleccionar división</option>
              <option value="1ra">1ra</option>
              <option value="2da">2da</option>
              <option value="3ra">3ra</option>
              <option value="4ta">4ta</option>
              <option value="5ta">5ta</option>
              <option value="6ta">6ta</option>
              <option value="7ma">7ma</option>
              <option value="8va">8va</option>
              <option value="9na">9na</option>
            </select>
          </div>

          <div class="form-group">
            <label for="especialidadSelectProfesor">Especialidad:</label>
            <select id="especialidadSelectProfesor">
              <option value="">Seleccionar especialidad</option>
              <option value="Informática">Informática</option>
              <option value="Maestro Mayor de Obra">Maestro Mayor de Obra</option>
              <option value="Electromecánica">Electromecánica</option>
              <option value="Química">Química</option>
              <option value="Ciclo Básico">Ciclo Básico</option>
            </select>
          </div>

          <div class="form-group">
            <label for="materiaSelectAdmin">Materia:</label>
            <select id="materiaSelectAdmin" name="materiaSelectAdmin" required>
              <option value="">Seleccione Año, División y Especialidad</option>
            </select>
          </div>

          <div class="form-group">
            <label for="turnoSelectProfesor">Turno:</label>
            <select id="turnoSelectProfesor">
              <option value="">Seleccionar turno</option>
              <option value="Mañana">Mañana</option>
              <option value="Tarde">Tarde</option>
              <option value="Vespertino">Vespertino</option>
            </select>
          </div>
          <button type="submit">Asignar Materia</button>
        </form>
      </div>

      <div class="form-container">
        <h2>Asignar Preceptor a Curso</h2>
        <form id="asignarPreceptorForm">
          <div class="form-group">
            <label for="preceptorSelectAdmin">Preceptor:</label>
            <select id="preceptorSelectAdmin" name="preceptorSelectAdmin" required></select>
          </div>
          <div class="form-group">
            <label for="anioInputPreceptorAdmin">Año:</label>
            <select id="anioInputPreceptorAdmin">
              <option value="">Seleccionar año</option>
              <option value="1ro">1ro</option>
              <option value="2do">2do</option>
              <option value="3ro">3ro</option>
              <option value="4to">4to</option>
              <option value="5to">5to</option>
              <option value="6to">6to</option>
              <option value="7mo">7mo</option>
            </select>
          </div>
          <div class="form-group">
            <label for="divisionInputPreceptorAdmin">División:</label>
            <select id="divisionInputPreceptorAdmin">
              <option value="">Seleccionar división</option>
              <option value="1ra">1ra</option>
              <option value="2da">2da</option>
              <option value="3ra">3ra</option>
              <option value="4ta">4ta</option>
              <option value="5ta">5ta</option>
              <option value="6ta">6ta</option>
              <option value="7ma">7ma</option>
              <option value="8va">8va</option>
              <option value="9na">9na</option>
            </select>
          </div>
          <div class="form-group">
            <label for="turnoInputPreceptorAdmin">Turno:</label>
            <select id="turnoInputPreceptorAdmin">
              <option value="">Seleccionar turno</option>
              <option value="Mañana">Mañana</option>
              <option value="Tarde">Tarde</option>
              <option value="Vespertino">Vespertino</option>
            </select>
          </div>
          <button type="submit">Asignar Preceptor</button>
        </form>
      </div>
    </div>

    <div id="tablas-gestion-vertical" style="max-width: 1700px; margin: 20px auto;">

      <div class="form-container" style="margin-bottom: 30px;">
        <h2>Gestionar Materias</h2>
        <div class="form-group" style="margin-top: 10px;">
          <label for="filtroEspecialidadMateria">Filtrar por Especialidad:</label>
          <select id="filtroEspecialidadMateria">
            <option value="">Todas las Materias</option>
            <option value="Informática">Informática</option>
            <option value="Maestro Mayor de Obra">Maestro Mayor de Obra</option>
            <option value="Electromecánica">Electromecánica</option>
            <option value="Química">Química</option>
            <option value="Ciclo Básico">Ciclo Básico</option>
            <option value="Tronco Común">Tronco Común (Áulicas)</option>
          </select>
        </div>

        <div style="max-height: 400px; overflow-y: auto; margin-bottom: 20px; border: 1px solid #ccc;">
          <table class="boletin" id="materiasTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre de la Materia</th>
                <th>Especialidad</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="4">Cargando materias...</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="contenedor-botones">
          <button onclick="openCreateMateriaModal()"><b>➕ Crear Materia</b></button>
        </div>
      </div>

      <div class="form-container">
        <h2>Profesores por Curso</h2>
        <p style="text-align: left; margin-top: 0; margin-bottom: 10px;">Filtrar por Año y División</p>
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
          <select id="filtroAnioProf">
            <option value="">Filtrar Año</option>
          </select>
          <select id="filtroDivisionProf">
            <option value="">Filtrar División</option>
          </select>
        </div>
        <div style="max-height: 400px; overflow-y: auto; margin-bottom: 20px; border: 1px solid #ccc;">
          <table class="boletin" id="profesoresFiltradosTable">
            <thead>
              <tr>
                <th>Profesor</th>
                <th>Materia</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="2">Seleccione un curso.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div id="userModal" class="modal">
      <div class="modal-contenido">
        <div class="modal-header">
          <h2 id="modalTitle"></h2>
          <button class="cerrar-btn" onclick="closeModal('userModal')">&times;</button>
        </div>
        <form id="userForm" onsubmit="handleCreateUser(event)">
          <div class="modal-body">
            <input type="hidden" id="originalEmail">
            <div class="form-group">
              <label for="userFullname">Nombre Completo</label>
              <input type="text" id="userFullname" placeholder="Nombre y Apellido" required>
            </div>
            <div class="form-group">
              <label for="userDni">DNI</label>
              <input type="text" id="userDni" placeholder="Documento Nacional de Identidad" required>
            </div>
            <div class="form-group">
              <label for="userEmail">Correo Electrónico</label>
              <input type="email" id="userEmail" placeholder="usuario@eest5.com" required>
              <span id="emailError" class="error-message">Este correo ya está registrado.</span>
            </div>
            <div class="form-group">
              <label for="userPassword">Contraseña</label>
              <input type="password" id="userPassword" placeholder="Dejar en blanco para no cambiar">
            </div>
            <div class="form-group">
              <label for="userRole">Rol</label>
              <select id="userRole" required>
                <option value="Alumno">Alumno</option>
                <option value="Profesor">Profesor</option>
                <option value="Preceptor">Preceptor</option>
                <option value="Administrador">Administrador</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-cancel" onclick="closeModal('userModal')">Cancelar</button>
            <button type="submit" class="btn btn-submit">Guardar</button>
          </div>
        </form>
      </div>
    </div>

    <div id="materiaModal" class="modal">
      <div class="modal-contenido">
        <div class="modal-header">
          <h2>Crear Nueva Materia</h2>
          <button class="cerrar-btn" onclick="closeModal('materiaModal')">&times;</button>
        </div>
        <form id="materiaForm" onsubmit="handleCreateMateria(event)">
          <div class="modal-body">
            <div class="form-group">
              <label for="materiaNombre">Nombre de la Materia</label>
              <input type="text" id="materiaNombre" placeholder="Ej: Programación" required>
            </div>

            <div class="form-group">
              <label for="materiaEspecialidad">Especialidad (Opcional)</label>
              <select id="materiaEspecialidad">
                <option value="">Ninguna / Tronco Común</option>
                <option value="Informática">Informática</option>
                <option value="Maestro Mayor de Obra">Maestro Mayor de Obra</option>
                <option value="Electromecánica">Electromecánica</option>
                <option value="Química">Química</option>
                <option value="Ciclo Básico">Ciclo Básico</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-cancel" onclick="closeModal('materiaModal')">Cancelar</button>
            <button type="submit" class="btn btn-submit">Guardar</button>
          </div>
        </form>
      </div>
    </div>

    <div id="deleteModal" class="modal">
      <div class="modal-contenido">
        <div class="modal-header">
          <h2>Confirmar Eliminación</h2>
          <button class="cerrar-btn" onclick="closeModal('deleteModal')">&times;</button>
        </div>
        <div class="modal-body delete-modal-body">
          <i class="fas fa-exclamation-triangle"></i>
          <p id="deleteMessage"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-cancel" onclick="closeModal('deleteModal')">Cancelar</button>
          <button type="button" id="confirmDeleteBtn" class="btn btn-danger">Eliminar</button>
        </div>
      </div>
    </div>

    <div id="approvalModal" class="modal">
      <div class="modal-contenido">
        <div class="modal-header">
          <h2>Aprobar Solicitud</h2>
          <button class="cerrar-btn" onclick="closeModal('approvalModal')">&times;</button>
        </div>
        <div class="modal-body">
          <p><strong>Correo:</strong> <span id="approveEmail"></span></p>
          <p><strong>Nombre:</strong> <span id="approveName"></span></p>
          <p><strong>DNI:</strong> <span id="approveDni"></span></p>
          <p><strong>Rol:</strong> <span id="approveRole"></span></p>
          <hr>
          <div class="form-group">
            <label for="approveRoleSelect">Asignar Rol</label>
            <select id="approveRoleSelect" required>
              <option value="">Seleccionar rol</option>
              <option value="Profesor">Profesor</option>
              <option value="Alumno">Alumno</option>
              <option value="Preceptor">Preceptor</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-cancel" onclick="closeModal('approvalModal')">Cancelar</button>
          <button type="button" id="confirmApproveBtn" class="btn btn-submit">Aprobar Usuario</button>
        </div>
      </div>
    </div>
    <script src="../js/admin.js"></script>

    <div id="alertModal" class="modal">
      <div class="modal-contenido">
        <div class="modal-header">
          <h2>Notificación</h2>
          <button class="cerrar-btn" onclick="closeModal('alertModal')">&times;</button>
        </div>
        <div class="modal-body" style="text-align: center; font-size: 18px;">
          <p id="alertMessage"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-submit" onclick="closeModal('alertModal')">Aceptar</button>
        </div>
      </div>
    </div>
</body>

</html>